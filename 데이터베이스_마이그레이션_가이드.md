# ğŸ”„ ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ

## ğŸ“‹ ì¶”ê°€ëœ ëª¨ë¸

ë‹¤ìŒ ëª¨ë¸ë“¤ì´ Prisma ìŠ¤í‚¤ë§ˆì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤:

1. **ResidentFamily** - ê°€ì¡±-ì…ì†Œì ì—°ê²° ê´€ê³„
2. **Notification** - ì•Œë¦¼ ì‹œìŠ¤í…œ

---

## ğŸš€ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ ë°©ë²•

### ë°©ë²• 1: Prisma Migrate ì‚¬ìš© (ê¶Œì¥)

```bash
# 1. Prisma í´ë¼ì´ì–¸íŠ¸ ìƒì„±
npm run db:generate
# ë˜ëŠ”
npx prisma generate

# 2. ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„± ë° ì ìš©
npx prisma migrate dev --name add_resident_family_and_notification

# 3. (ì„ íƒ) Prisma Studioë¡œ í™•ì¸
npm run db:studio
```

### ë°©ë²• 2: Prisma DB Push ì‚¬ìš© (ê°œë°œ ì¤‘ ë¹ ë¥¸ ì ìš©)

```bash
# 1. Prisma í´ë¼ì´ì–¸íŠ¸ ìƒì„±
npm run db:generate

# 2. ë°ì´í„°ë² ì´ìŠ¤ì— ì§ì ‘ í‘¸ì‹œ (ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„± ì•ˆ í•¨)
npm run db:push
```

### ë°©ë²• 3: í”„ë¡œë•ì…˜ í™˜ê²½

```bash
# 1. Prisma í´ë¼ì´ì–¸íŠ¸ ìƒì„±
npm run db:generate

# 2. ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš© (ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì´ ìˆëŠ” ê²½ìš°)
npx prisma migrate deploy

# ë˜ëŠ” DB Push ì‚¬ìš©
npx prisma db push
```

---

## ğŸ“ ì¶”ê°€ëœ í…Œì´ë¸” êµ¬ì¡°

### ResidentFamily í…Œì´ë¸”
- `id` (String, Primary Key)
- `residentId` (String, Foreign Key â†’ Resident)
- `userId` (String, Foreign Key â†’ User)
- `relationship` (String) - ê´€ê³„ (ë¶€, ëª¨, ìë…€, ë°°ìš°ì ë“±)
- `isApproved` (Boolean, Default: false)
- `approvedById` (String?, Nullable)
- `approvedAt` (DateTime?, Nullable)
- `createdAt` (DateTime)
- `updatedAt` (DateTime)
- Unique: `residentId + userId`
- Indexes: `residentId`, `userId`, `isApproved`

### Notification í…Œì´ë¸”
- `id` (String, Primary Key)
- `type` (NotificationType Enum)
- `title` (String)
- `content` (String?, Nullable, Text)
- `userId` (String, Foreign Key â†’ User)
- `relatedId` (String?, Nullable)
- `relatedType` (String?, Nullable)
- `isRead` (Boolean, Default: false)
- `createdAt` (DateTime)
- Indexes: `userId`, `isRead`, `createdAt`

### NotificationType Enum
- `PostCreated`
- `CommentCreated`
- `MedicalRecordCreated`
- `OrderCreated`
- `OrderStatusChanged`
- `FamilyRequest`
- `FamilyApproved`
- `FamilyRejected`
- `Other`

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **ê¸°ì¡´ ë°ì´í„° ìœ ì§€**: ë§ˆì´ê·¸ë ˆì´ì…˜ì€ ê¸°ì¡´ ë°ì´í„°ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.
2. **ì™¸ë˜ í‚¤ ê´€ê³„**: ResidentFamilyì™€ Notificationì€ User ë° Residentì™€ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
3. **Cascade ì‚­ì œ**: 
   - User ì‚­ì œ ì‹œ ê´€ë ¨ ResidentFamilyì™€ Notificationë„ ìë™ ì‚­ì œ
   - Resident ì‚­ì œ ì‹œ ê´€ë ¨ ResidentFamilyë„ ìë™ ì‚­ì œ

---

## ğŸ” ë§ˆì´ê·¸ë ˆì´ì…˜ í™•ì¸

ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸:

```bash
# Prisma Studio ì‹¤í–‰ (ë¸Œë¼ìš°ì €ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸)
npm run db:studio

# ë˜ëŠ” ì§ì ‘ ì¿¼ë¦¬ë¡œ í™•ì¸
npx prisma db execute --stdin < í™•ì¸ì¿¼ë¦¬.sql
```

---

## ğŸ› ë¬¸ì œ í•´ê²°

### ì—ëŸ¬: "Migration failed"
- ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸
- DATABASE_URL í™˜ê²½ ë³€ìˆ˜ í™•ì¸
- ê¸°ì¡´ í…Œì´ë¸”ê³¼ì˜ ì¶©ëŒ í™•ì¸

### ì—ëŸ¬: "Schema is not in sync"
```bash
# ìŠ¤í‚¤ë§ˆ ë™ê¸°í™”
npx prisma db pull
npx prisma generate
```

### ì—ëŸ¬: "Foreign key constraint"
- ê¸°ì¡´ ë°ì´í„°ì˜ ë¬´ê²°ì„± í™•ì¸
- ìˆœì„œëŒ€ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰

---

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„

ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ì™„ë£Œë˜ë©´:

1. âœ… ì•± ì¬ì‹œì‘
2. âœ… ìƒˆë¡œìš´ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
3. âœ… ì•Œë¦¼ ì‹œìŠ¤í…œ ì‘ë™ í™•ì¸
4. âœ… ê°€ì¡±-ì…ì†Œì ì—°ê²° ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

---

**ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì‹¤í–‰í•œ í›„ ì•±ì„ ì¬ì‹œì‘í•˜ì„¸ìš”!** ğŸš€

